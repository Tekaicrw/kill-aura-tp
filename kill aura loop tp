if shared.settings then return end

shared.settings = {
	killaura = true,
	maxdistance = 50,
	revolverTimeout = 1
}

shared.config = {
	teleportOffset = Vector3.new(0,0,0)
}

--// SERVICES
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local lp = Players.LocalPlayer
local PlayerGui = lp:WaitForChild("PlayerGui")

--// ALLOWED USERS
local AllowedUsers = {
	["goingtoitsend"] = true,
	["Colgumelonorth"] = true,
	["31returned"] = true,
}

--// ALLOWED ITEMS
local AllowedItems = {
	["Halloween Dagger"] = true, ["Baseball Bat"] = true, ["Katana"] = true,
	["Knife"] = true, ["Pan"] = true, ["Scythe"] = true, ["Kawaii Revolver"] = true
}

--// TARGETS
local alvos = {}
local selecionados = {}
local isActive = false
local revolverMode = false
local targetTimers = {}

--// LOOPKILL REVOLVER VARIABLES
local currentTargetIndex = 1
local cooldown = 0.9
local canShoot = true
local loopkillActive = false

--// BASE FUNCTIONS
local function getchar(plr, yield)
	plr = plr or lp
	return plr.Character or (yield and plr.CharacterAdded:Wait())
end

local function gethumanoid(plr)
	local char = getchar(plr)
	return char and char:FindFirstChildOfClass("Humanoid")
end

local function gethrp(plr)
	local char = getchar(plr)
	return char and char:FindFirstChild("HumanoidRootPart")
end

local function getDamageRemote()
	local char = getchar(nil, true)
	for _, tool in pairs(char:GetChildren()) do
		if tool:IsA("Tool") and tool:FindFirstChild("DamageRemote") then
			return tool.DamageRemote
		end
	end
	return nil
end

local function teleportAllParts(myChar, targetPos)
	if not myChar then return end
	
	if targetPos.Y < -500 then
		targetPos = Vector3.new(targetPos.X, 100, targetPos.Z)
	end
	
	local parts = {
		"HumanoidRootPart", "Head", "Torso", "Left Arm", "Right Arm", "Left Leg", "Right Leg"
	}
	
	for _, partName in pairs(parts) do
		local part = myChar:FindFirstChild(partName)
		if part then
			part.CFrame = CFrame.new(targetPos) * CFrame.new(shared.config.teleportOffset)
		end
	end
end

local function alvoTemItem(plr)
	if type(plr) ~= "userdata" or not plr:IsA("Player") then return false end
	local bp = plr:FindFirstChild("Backpack")
	if bp then
		for _,v in ipairs(bp:GetChildren()) do
			if v:IsA("Tool") and AllowedItems[v.Name] then return true end
		end
	end
	local char = plr.Character
	if char then
		for _,v in ipairs(char:GetChildren()) do
			if v:IsA("Tool") and AllowedItems[v.Name] then return true end
		end
	end
	return false
end

local function hasRevolverEquipped()
	local char = lp.Character
	if char and char:FindFirstChild("Kawaii Revolver") then return true end
	return false
end

local function shootRevolver()
	if not canShoot or not loopkillActive or #alvos == 0 then return end
	
	if not hasRevolverEquipped() then
		loopkillActive = false
		revolverMode = false
		saveState()
		notify("Revolver mode STOPPED - No Kawaii Revolver equipped!")
		return
	end
	
	local target = alvos[currentTargetIndex]
	if not target or not target.Character then 
		currentTargetIndex = currentTargetIndex + 1
		if currentTargetIndex > #alvos then currentTargetIndex = 1 end
		return 
	end
	
	local char = lp.Character
	if not char then return end
	
	local weapon = char:FindFirstChild("Kawaii Revolver")
	if not weapon then return end
	
	local hum = target.Character:FindFirstChildOfClass("Humanoid")
	if not hum or hum.Health <= 0 then
		currentTargetIndex = currentTargetIndex + 1
		if currentTargetIndex > #alvos then currentTargetIndex = 1 end
		return
	end
	
	local remote = weapon:FindFirstChild("DamageRemote")
	if not remote then return end
	
	canShoot = false
	
	pcall(function()
		remote:FireServer(hum)
	end)
	
	task.wait(cooldown)
	canShoot = true
end

local function getPlayer(name)
	name = name:lower()
	for _, p in pairs(Players:GetPlayers()) do
		if p ~= lp then
			if p.Name:lower():find(name) or p.DisplayName:lower():find(name) then
				return p
			end
		end
	end
	return nil
end

local function notify(msg)
	game:GetService("StarterGui"):SetCore("SendNotification", {
		Title = "Unified System",
		Text = msg,
		Duration = 3
	})
end

local function saveState()
	local toSave = {
		targets = {},
		isActive = isActive,
		revolverMode = revolverMode,
		loopkillActive = loopkillActive,
		targetTimers = {}
	}
	for plr, ok in pairs(selecionados) do
		if ok and plr then table.insert(toSave.targets, plr.Name) end
	end
	for plr, time in pairs(targetTimers) do
		if type(plr) == "userdata" and plr:IsA("Player") then
			toSave.targetTimers[plr.Name] = tick() - time
		end
	end
	if not isfolder("UnifiedData") then makefolder("UnifiedData") end
	writefile("UnifiedData/unified_state.json", HttpService:JSONEncode(toSave))
end

local function loadState()
	if isfile("UnifiedData/unified_state.json") then
		local success, data = pcall(function()
			return HttpService:JSONDecode(readfile("UnifiedData/unified_state.json"))
		end)
		if success and data then return data end
	end
	return {targets = {}, isActive = false, revolverMode = false, loopkillActive = false, targetTimers = {}}
end

local updateList, updatePlayersList

--// CHAT COMMANDS
local function handleCommand(text)
	text = text:lower()
	
	if text == "?start" or text == "/start" then
		if #alvos > 0 then
			isActive = true
			revolverMode = false
			loopkillActive = false
			for _, plr in ipairs(alvos) do
				if type(plr) == "userdata" and plr:IsA("Player") then
					targetTimers[plr] = tick()
				end
			end
			saveState()
			notify("System STARTED!")
		else
			notify("No targets selected!")
		end
	elseif text == "?stop" or text == "/stop" then
		isActive = false
		revolverMode = false
		loopkillActive = false
		targetTimers = {}
		saveState()
		notify("System STOPPED!")
	elseif text:sub(1, 7) == "?select" or text:sub(1, 7) == "/select" then
		local name = text:sub(9)
		if name ~= "" then
			local target = getPlayer(name)
			if target then
				local found = false
				for _, p in ipairs(alvos) do
					if p == target then found = true break end
				end
				if not found then
					selecionados[target] = true
					table.insert(alvos, target)
					notify("Selected: " .. target.DisplayName)
					saveState()
					if updateList then updateList() end
					if updatePlayersList then updatePlayersList() end
				else
					notify("Already selected!")
				end
			else
				notify("Player not found!")
			end
		end
	elseif text:sub(1, 9) == "?unselect" or text:sub(1, 9) == "/unselect" then
		local name = text:sub(11)
		if name ~= "" then
			local target = getPlayer(name)
			if target then
				for i, p in ipairs(alvos) do
					if p == target then
						table.remove(alvos, i)
						selecionados[target] = nil
						targetTimers[target] = nil
						notify("Unselected: " .. target.DisplayName)
						saveState()
						if updateList then updateList() end
						if updatePlayersList then updatePlayersList() end
						return
					end
				end
				notify("Not in list!")
			else
				notify("Player not found!")
			end
		else
			alvos = {}
			selecionados = {}
			targetTimers = {}
			notify("Cleared all targets!")
			saveState()
			if updateList then updateList() end
			if updatePlayersList then updatePlayersList() end
		end
	end
end

--// SYNC SYSTEM
if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
	TextChatService.MessageReceived:Connect(function(message)
		if message.TextSource then
			local sender = Players:GetPlayerByUserId(message.TextSource.UserId)
			if sender and AllowedUsers[sender.Name] then
				handleCommand(message.Text)
			end
		end
	end)
else
	for _, player in ipairs(Players:GetPlayers()) do
		if AllowedUsers[player.Name] then
			player.Chatted:Connect(function(msg)
				handleCommand(msg)
			end)
		end
	end
	
	Players.PlayerAdded:Connect(function(player)
		if AllowedUsers[player.Name] then
			player.Chatted:Connect(function(msg)
				handleCommand(msg)
			end)
		end
	end)
end

--// TIMER CHECK SYSTEM
task.spawn(function()
	while task.wait(0.5) do
		if not isActive then continue end
		
		local shouldActivateRevolver = false
		local hasArmedTarget = false
		
		for _, plr in ipairs(alvos) do
			if type(plr) == "userdata" and plr:IsA("Player") and alvoTemItem(plr) then
				hasArmedTarget = true
				targetTimers[plr] = tick()
				break
			end
		end
		
		if hasArmedTarget then
			if revolverMode then
				revolverMode = false
				loopkillActive = false
				saveState()
				notify("Kill Aura mode ACTIVATED!")
			end
		else
			for plr, startTime in pairs(targetTimers) do
				if type(plr) == "userdata" and plr:IsA("Player") then
					if not alvoTemItem(plr) then
						if tick() - startTime > shared.settings.revolverTimeout then
							shouldActivateRevolver = true
							break
						end
					end
				end
			end
			
			if shouldActivateRevolver and not revolverMode then
				revolverMode = true
				loopkillActive = true
				currentTargetIndex = 1
				saveState()
				notify("Revolver Loopkill ACTIVATED!")
			end
		end
	end
end)

--// LOOPKILL REVOLVER SHOOTER
task.spawn(function()
	while task.wait(0.05) do
		if revolverMode and loopkillActive then
			shootRevolver()
		end
	end
end)

--// LOOPKILL REVOLVER UPDATE
task.spawn(function()
	while task.wait(2) do
		if revolverMode and loopkillActive then
			if not canShoot then
				canShoot = true
			end
			if not hasRevolverEquipped() then
				loopkillActive = false
				revolverMode = false
				saveState()
				notify("Revolver mode STOPPED - No Kawaii Revolver equipped!")
			end
		end
	end
end)

--// KILL AURA
task.spawn(function()
	while task.wait(0.01) do
		if not shared.settings.killaura or not isActive or revolverMode then continue end
		
		local myChar = getchar(lp)
		if not myChar then continue end
		
		local myHrp = gethrp(lp)
		if not myHrp then continue end
		
		if myHrp.Position.Y < -500 then
			myHrp.CFrame = CFrame.new(myHrp.Position.X, 100, myHrp.Position.Z)
		end
		
		local foundRemote = getDamageRemote()
		if not foundRemote then continue end
		
		for _,plr in ipairs(alvos) do
			if type(plr) == "userdata" and plr:IsA("Player") then
				if alvoTemItem(plr) then
					local hum = gethumanoid(plr)
					local hrp = gethrp(plr)
					if hum and hrp and hum.Health > 0 then
						local distance = (myHrp.Position - hrp.Position).Magnitude
						if distance <= shared.settings.maxdistance then
							pcall(function()
								foundRemote:FireServer(hum)
							end)
							task.wait(0.1)
							break
						end
					end
				end
			end
		end
	end
end)

--// TELEPORT FOR REVOLVER MODE
task.spawn(function()
	while task.wait(0.1) do
		if not isActive then continue end
		
		if revolverMode and loopkillActive and #alvos > 0 then
			local target = alvos[currentTargetIndex]
			if target and type(target) == "userdata" and target:IsA("Player") then
				local myChar = getchar(lp)
				local targetChar = getchar(target)
				if myChar and targetChar then
					if myChar:FindFirstChildOfClass("ForceField") then continue end
					if targetChar:FindFirstChildOfClass("ForceField") then continue end
					local targetHrp = gethrp(target)
					local targetHum = gethumanoid(target)
					if targetHrp and targetHum and targetHum.Health > 0 then
						teleportAllParts(myChar, targetHrp.Position)
					end
				end
			end
		else
			for _,alvo in ipairs(alvos) do
				if type(alvo) == "userdata" and alvo:IsA("Player") then
					if alvoTemItem(alvo) then
						local myChar = getchar(lp)
						local alvoChar = getchar(alvo)
						if myChar and myChar:FindFirstChildOfClass("ForceField") then continue end
						if alvoChar and alvoChar:FindFirstChildOfClass("ForceField") then continue end
						local ahrp = gethrp(alvo)
						local hum = gethumanoid(alvo)
						if ahrp and hum and hum.Health > 0 then
							teleportAllParts(myChar, ahrp.Position)
							break
						end
					end
				end
			end
		end
	end
end)

--// UI
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "UnifiedSystemUI"
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 250, 0, 390)
Frame.Position = UDim2.new(0.5, -125, 0.5, -195)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true

Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 12)
Instance.new("UIStroke", Frame).Color = Color3.fromRGB(0, 255, 255)
Frame:FindFirstChildOfClass("UIStroke").Thickness = 2

local Header = Instance.new("Frame", Frame)
Header.Size = UDim2.new(1, 0, 0, 40)
Header.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
Header.BorderSizePixel = 0
Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 12)

local HeaderFix = Instance.new("Frame", Header)
HeaderFix.Size = UDim2.new(1, 0, 0, 20)
HeaderFix.Position = UDim2.new(0, 0, 1, -20)
HeaderFix.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
HeaderFix.BorderSizePixel = 0

local Title = Instance.new("TextLabel", Header)
Title.Text = "üéØ Unified System"
Title.Size = UDim2.new(1, -40, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(0, 0, 0)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextXAlignment = Enum.TextXAlignment.Left

local ToggleBtn = Instance.new("TextButton", Header)
ToggleBtn.Text = "‚àí"
ToggleBtn.Size = UDim2.new(0, 30, 0, 30)
ToggleBtn.Position = UDim2.new(1, -35, 0, 5)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.TextSize = 20
ToggleBtn.BorderSizePixel = 0
Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(0, 6)

local Lista = Instance.new("ScrollingFrame", Frame)
Lista.Size = UDim2.new(1, -20, 0, 100)
Lista.Position = UDim2.new(0, 10, 0, 50)
Lista.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
Lista.BorderSizePixel = 0
Lista.ScrollBarThickness = 4
Instance.new("UICorner", Lista).CornerRadius = UDim.new(0, 8)

local UIList = Instance.new("UIListLayout", Lista)
UIList.Padding = UDim.new(0, 3)

local StartBtn = Instance.new("TextButton", Frame)
StartBtn.Text = "‚ñ∂ START"
StartBtn.Size = UDim2.new(0.48, 0, 0, 35)
StartBtn.Position = UDim2.new(0, 10, 0, 160)
StartBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
StartBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
StartBtn.Font = Enum.Font.GothamBold
StartBtn.TextSize = 16
StartBtn.BorderSizePixel = 0
Instance.new("UICorner", StartBtn).CornerRadius = UDim.new(0, 8)

local StopBtn = Instance.new("TextButton", Frame)
StopBtn.Text = "‚è∏ STOP"
StopBtn.Size = UDim2.new(0.48, 0, 0, 35)
StopBtn.Position = UDim2.new(0.52, 0, 0, 160)
StopBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
StopBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
StopBtn.Font = Enum.Font.GothamBold
StopBtn.TextSize = 16
StopBtn.BorderSizePixel = 0
Instance.new("UICorner", StopBtn).CornerRadius = UDim.new(0, 8)

--// PLAYERS LIST PANEL
local PlayersFrame = Instance.new("Frame", Frame)
PlayersFrame.Size = UDim2.new(1, -20, 0, 180)
PlayersFrame.Position = UDim2.new(0, 10, 0, 205)
PlayersFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
PlayersFrame.BorderSizePixel = 0
Instance.new("UICorner", PlayersFrame).CornerRadius = UDim.new(0, 8)

local PlayersTitle = Instance.new("TextLabel", PlayersFrame)
PlayersTitle.Text = "üë• Jogadores Online"
PlayersTitle.Size = UDim2.new(1, 0, 0, 25)
PlayersTitle.BackgroundTransparency = 1
PlayersTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
PlayersTitle.Font = Enum.Font.GothamBold
PlayersTitle.TextSize = 14

local PlayersScroll = Instance.new("ScrollingFrame", PlayersFrame)
PlayersScroll.Size = UDim2.new(1, -10, 1, -30)
PlayersScroll.Position = UDim2.new(0, 5, 0, 25)
PlayersScroll.BackgroundTransparency = 1
PlayersScroll.ScrollBarThickness = 3

local PlayersLayout = Instance.new("UIListLayout", PlayersScroll)
PlayersLayout.Padding = UDim.new(0, 2)

local isMinimized = false

ToggleBtn.MouseButton1Click:Connect(function()
	isMinimized = not isMinimized
	if isMinimized then
		Frame.Size = UDim2.new(0, 250, 0, 40)
		ToggleBtn.Text = "+"
		Lista.Visible = false
		StartBtn.Visible = false
		StopBtn.Visible = false
		PlayersFrame.Visible = false
	else
		Frame.Size = UDim2.new(0, 250, 0, 390)
		ToggleBtn.Text = "‚àí"
		Lista.Visible = true
		StartBtn.Visible = true
		StopBtn.Visible = true
		PlayersFrame.Visible = true
	end
end)

updateList = function()
	for _, c in pairs(Lista:GetChildren()) do
		if c:IsA("TextLabel") then c:Destroy() end
	end
	
	if #alvos == 0 then
		local Empty = Instance.new("TextLabel", Lista)
		Empty.Text = "No targets selected"
		Empty.Size = UDim2.new(1, -5, 0, 30)
		Empty.BackgroundTransparency = 1
		Empty.TextColor3 = Color3.fromRGB(150, 150, 150)
		Empty.Font = Enum.Font.Gotham
		Empty.TextSize = 14
	else
		for _, p in ipairs(alvos) do
			local Item = Instance.new("TextLabel", Lista)
			local isInGame = Players:FindFirstChild(p.Name) ~= nil
			local modeText = ""
			if isActive then
				if revolverMode then
					modeText = " [LOOPKILL]"
				elseif alvoTemItem(p) then
					modeText = " [KILL AURA]"
				else
					modeText = " [WAITING]"
				end
			end
			Item.Text = "‚Ä¢ " .. p.DisplayName .. " (@" .. p.Name .. ")" .. (not isInGame and " [OFFLINE]" or "") .. modeText
			Item.Size = UDim2.new(1, -5, 0, 30)
			if not isInGame then
				Item.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
			else
				Item.BackgroundColor3 = alvoTemItem(p) and Color3.fromRGB(0, 255, 140) or Color3.fromRGB(120, 120, 120)
			end
			Item.TextColor3 = Color3.fromRGB(0, 0, 0)
			Item.Font = Enum.Font.GothamBold
			Item.TextSize = 14
			Item.TextXAlignment = Enum.TextXAlignment.Left
			Item.BorderSizePixel = 0
			Instance.new("UICorner", Item).CornerRadius = UDim.new(0, 6)
			local Padding = Instance.new("UIPadding", Item)
			Padding.PaddingLeft = UDim.new(0, 8)
		end
	end
	
	Lista.CanvasSize = UDim2.new(0, 0, 0, UIList.AbsoluteContentSize.Y)
end

updatePlayersList = function()
	for _, child in pairs(PlayersScroll:GetChildren()) do
		if child:IsA("TextButton") then child:Destroy() end
	end
	
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= lp then
			local PlayerBtn = Instance.new("TextButton", PlayersScroll)
			PlayerBtn.Size = UDim2.new(1, -5, 0, 25)
			PlayerBtn.BackgroundColor3 = selecionados[player] and Color3.fromRGB(0, 150, 255) or Color3.fromRGB(40, 40, 45)
			PlayerBtn.Text = "‚Ä¢ " .. player.DisplayName .. " (@" .. player.Name .. ")"
			PlayerBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
			PlayerBtn.Font = Enum.Font.Gotham
			PlayerBtn.TextSize = 12
			PlayerBtn.TextXAlignment = Enum.TextXAlignment.Left
			Instance.new("UICorner", PlayerBtn).CornerRadius = UDim.new(0, 4)
			
			local Padding = Instance.new("UIPadding", PlayerBtn)
			Padding.PaddingLeft = UDim.new(0, 8)
			
			PlayerBtn.MouseButton1Click:Connect(function()
				if selecionados[player] then
					for i, p in ipairs(alvos) do
						if p == player then
							table.remove(alvos, i)
							selecionados[player] = nil
							targetTimers[player] = nil
							notify("Unselected: " .. player.DisplayName)
							break
						end
					end
				else
					selecionados[player] = true
					table.insert(alvos, player)
					notify("Selected: " .. player.DisplayName)
				end
				saveState()
				updateList()
				updatePlayersList()
			end)
		end
	end
	
	PlayersScroll.CanvasSize = UDim2.new(0, 0, 0, PlayersLayout.AbsoluteContentSize.Y)
end

StartBtn.MouseButton1Click:Connect(function()
	handleCommand("?start")
end)

StopBtn.MouseButton1Click:Connect(function()
	handleCommand("?stop")
end)

--// UPDATE PLAYERS LIST EVERY 3 SECONDS
task.spawn(function()
	while task.wait(3) do
		updatePlayersList()
	end
end)

Players.PlayerAdded:Connect(updatePlayersList)
Players.PlayerRemoving:Connect(updatePlayersList)
updatePlayersList()

--// LOAD SAVED STATE
task.spawn(function()
	task.wait(1)
	local savedState = loadState()
	for _, name in ipairs(savedState.targets) do
		local player = Players:FindFirstChild(name)
		if player and player ~= lp then
			selecionados[player] = true
			table.insert(alvos, player)
		else
			local fakePlayer = {Name = name, DisplayName = name}
			selecionados[fakePlayer] = true
			table.insert(alvos, fakePlayer)
		end
	end
	
	isActive = savedState.isActive
	revolverMode = savedState.revolverMode or false
	loopkillActive = savedState.loopkillActive or false
	
	if isActive then
		for _, plr in ipairs(alvos) do
			if type(plr) == "userdata" and plr:IsA("Player") then
				local savedTime = savedState.targetTimers and savedState.targetTimers[plr.Name]
				if savedTime then
					targetTimers[plr] = tick() - savedTime
				else
					targetTimers[plr] = tick()
				end
			end
		end
		
		local statusMsg = "System AUTO-RESUMED with " .. #alvos .. " targets!"
		if revolverMode then
			statusMsg = statusMsg .. " [REVOLVER MODE]"
		end
		notify(statusMsg)
	end
	
	updateList()
	updatePlayersList()
end)

task.spawn(function()
	while task.wait(3) do
		if updateList then updateList() end
	end
end)

Players.PlayerRemoving:Connect(function(player)
	if selecionados[player] then
		for i, p in ipairs(alvos) do
			if p == player then
				local fakePlayer = {Name = player.Name, DisplayName = player.DisplayName}
				alvos[i] = fakePlayer
				selecionados[fakePlayer] = true
				selecionados[player] = nil
				targetTimers[player] = nil
				break
			end
		end
		updateList()
	end
end)

Players.PlayerAdded:Connect(function(player)
	for i, p in ipairs(alvos) do
		if type(p) == "table" and p.Name == player.Name then
			alvos[i] = player
			selecionados[p] = nil
			selecionados[player] = true
			if isActive then
				targetTimers[player] = tick()
				notify("Target " .. player.DisplayName .. " rejoined - timer restarted!")
			end
			updateList()
			break
		end
	end
end)

updateList()

loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source',true))()

--// TOOL EQUIP SYSTEM
local Backpack
local EquippedTools = {}
local HeartbeatConn
local ToolConnections = {}

local function cleanup()
	if HeartbeatConn then
		HeartbeatConn:Disconnect()
		HeartbeatConn = nil
	end
	for _, c in pairs(ToolConnections) do c:Disconnect() end
	ToolConnections = {}
	EquippedTools = {}
end

local function registerTool(tool)
	if not tool:IsA("Tool") then return end
	local equipConn = tool.Equipped:Connect(function()
		EquippedTools[tool] = true
	end)
	table.insert(ToolConnections, equipConn)
end

local function setupCharacter(character)
	cleanup()
	Backpack = lp:WaitForChild("Backpack")
	for _, tool in ipairs(Backpack:GetChildren()) do registerTool(tool) end
	Backpack.ChildAdded:Connect(registerTool)
	HeartbeatConn = RunService.Heartbeat:Connect(function()
		for tool in pairs(EquippedTools) do
			if tool.Parent ~= character then tool.Parent = character end
		end
	end)
end

lp.CharacterAdded:Connect(setupCharacter)
if lp.Character then setupCharacter(lp.Character) end

--// UNEQUIP BUTTON
local UnequipGui = Instance.new("ScreenGui")
UnequipGui.Name = "UnequipGui"
UnequipGui.ResetOnSpawn = false
UnequipGui.Parent = PlayerGui

local UnequipBtn = Instance.new("TextButton")
UnequipBtn.Size = UDim2.new(0, 110, 0, 28)
UnequipBtn.Position = UDim2.new(0, 10, 0, 10)
UnequipBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
UnequipBtn.TextColor3 = Color3.new(1, 1, 1)
UnequipBtn.Text = "Unequip ALL"
UnequipBtn.Font = Enum.Font.GothamBold
UnequipBtn.TextSize = 14
UnequipBtn.Parent = UnequipGui

UnequipBtn.MouseButton1Click:Connect(function()
	if not lp.Character then return end
	for tool in pairs(EquippedTools) do
		if tool.Parent == lp.Character then tool.Parent = Backpack end
	end
	EquippedTools = {}
end)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer

local function antiVoid()
	local char = lp.Character
	if not char then return end
	
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then return end
	
	-- Se estiver abaixo de Y = -30, teleporta para o centro do mapa
	if hrp.Position.Y < -30 then
		hrp.CFrame = CFrame.new(0, 100, 0)  -- Centro do mapa (0, 100, 0)
		print("Anti-Void: Teleportado para o centro do mapa!")
	end
end

-- Verifica a cada 0.1 segundos
RunService.Heartbeat:Connect(antiVoid)



--// EXPORT
_G.UnifiedSystem = {
	getTargets = function() return alvos end,
	isActive = function() return isActive end
}

notify("‚úÖ Unified System Loaded!")
